<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.11.xsd">

    <changeSet id="v1_0_0_begin" author="LucySm">
        <tagDatabase tag="v1.0.0"/>
    </changeSet>

    <changeSet id="v1_0_0_initial" author="LucySm">
        <comment>Initial</comment>

        <sqlFile path="./schemas/mapping_service.sql" relativeToChangelogFile="true" endDelimiter=""/>

        <sqlFile path="./tables/mapping_service.cmc_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.consumers.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.consumers_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.currency_with_network.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.mappings_with_stock_currencies.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.networks_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.stocks.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./tables/mapping_service.stocks_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>

        <sqlFile path="./functions/mapping_service.create_consumer.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./functions/mapping_service.create_consumer_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./functions/mapping_service.update_cmc_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>

        <sqlFile path="./functions/mapping_service.get_cmc_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./functions/mapping_service.update_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./functions/mapping_service.update_networks_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./functions/mapping_service.update_currency_with_network.sql" relativeToChangelogFile="true" endDelimiter=""/>
        <sqlFile path="./functions/mapping_service.update_stocks_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>

        <rollback>
            <!-- drop all functions -->
            DROP FUNCTION IF EXISTS mapping_service.create_consumer CASCADE;
            DROP FUNCTION IF EXISTS mapping_service.create_consumer_currencies_data CASCADE;
            DROP FUNCTION IF EXISTS mapping_service.update_cmc_currencies_data CASCADE;

            DROP FUNCTION IF EXISTS mapping_service.get_cmc_currencies_data CASCADE;
            DROP FUNCTION IF EXISTS mapping_service.update_currencies_data CASCADE;
            DROP FUNCTION IF EXISTS mapping_service.update_networks_data CASCADE;
            DROP FUNCTION IF EXISTS mapping_service.update_currency_with_network CASCADE;
            DROP FUNCTION IF EXISTS mapping_service.update_stocks_currencies_data CASCADE;

            <!-- drop all tables  -->
            <sqlFile path="./tables/rollback/mapping_service.cmc_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.consumers.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.consumers_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.currency_with_network.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.mappings_with_stock_currencies.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.networks_data.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.stocks.sql" relativeToChangelogFile="true" endDelimiter=""/>
            <sqlFile path="./tables/rollback/mapping_service.stocks_currencies_data.sql" relativeToChangelogFile="true" endDelimiter=""/>

            <!-- drop all schemas and roles -->
            <sqlFile path="./schemas/mapping_service.rollback.sql" relativeToChangelogFile="true" endDelimiter=""/>
        </rollback>

    </changeSet>

    <changeSet id="v1_0_0_end" author="LucySm"/>

</databaseChangeLog>
